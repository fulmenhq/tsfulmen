# TSFulmen v0.1.5 Release Notes

**Release Date**: November 5, 2025  
**Release Type**: Major Feature Release + Performance Optimization  
**Status**: ✅ Released

---

## Summary

TSFulmen v0.1.5 delivers enterprise-grade application lifecycle management with three major feature additions: complete application identity module, comprehensive cross-platform signal handling, and significant FulHash performance optimization (22x faster for small inputs). This release establishes TSFulmen as a production-ready foundation for TypeScript/Node.js applications requiring graceful shutdown patterns, configuration management, and high-performance hashing.

**Key Achievements**:

- Complete application identity module with discovery, validation, and caching
- Cross-platform signal handling with Windows fallback strategies
- 22x FulHash performance improvement for small inputs
- CLI tooling for developer workflows (signals, identity, schema)
- 100% test pass rate (1,465 tests passing)

---

## Features

### Application Identity Module (`@fulmenhq/tsfulmen/appidentity`)

Complete implementation of Crucible app-identity standard v1.0.0 for canonical application metadata management.

**Core Functions**:

- `loadIdentity()` - Load identity from `.fulmen/app.yaml`
- `getCachedIdentity()` - Process-level singleton cache
- `clearIdentityCache()` - Cache management

**Discovery Algorithm** (3-tier precedence):

1. Explicit path parameter
2. `FULMEN_APP_IDENTITY_PATH` environment variable
3. Ancestor search (20-level limit with rich error messages)

**Helper Functions** (8 convenience accessors):

- `getBinaryName()`, `getVendor()`, `getEnvPrefix()`, `getConfigName()`
- `getTelemetryNamespace()` with fallback to binary_name
- `getConfigIdentifiers()` returns frozen tuple for config paths
- `buildEnvVar()` with character normalization (`[^A-Z0-9_]` → `_`)
- `getEnvVar()` with default value support

**Key Features**:

- Schema validation against `app-identity/v1.0.0` schema
- Deep freezing for immutability guarantees
- Optional validation bypass for test scenarios
- Test injection via `identity` parameter
- Process-level caching with `skipCache` option

**CLI Commands**:

- `identity-show` - Display current identity (pretty/JSON)
- `identity-validate` - Validate identity file
- Proper exit codes (0, 51, 60) per Foundry catalog

**Makefile Integration**:

- `make validate-app-identity` - Quick validation
- `make verify-app-identity-parity` - Cross-language parity check

**Testing**: 93 test cases, 96.09% line coverage

### Signal Handling Module (`@fulmenhq/tsfulmen/foundry/signals`)

Comprehensive cross-platform signal handling implementing Crucible Foundry standard v1.0.0.

**Signal Catalog**:

- 8 POSIX signals with full behavior metadata
- Exit codes, default actions, retry hints, OS mappings
- Catalog access: `getSignalsVersion()`, `listSignals()`, `getSignal()`, `listBehaviors()`, `getBehavior()`

**Platform Capabilities**:

- Runtime detection: `isPOSIX()`, `isWindows()`, `supportsSignal()`, `supportsSignalExitCodes()`
- Guards with actionable errors: `ensureSupported()`, `ensurePOSIX()`, `ensureWindows()`

**Signal Manager**:

- `createSignalManager()` with FIFO execution, priority overrides
- Handler registration: `register()`, `unregister()`, `trigger()`, `shutdown()`, `isRegistered()`
- Timeout enforcement (30s default per handler)
- Comprehensive logging and telemetry (`fulmen.signal.*` events)

**Windows Fallback**:

- `handleWindowsFallback()` - Structured logging (INFO level) with telemetry
- `getHttpFallbackGuidance()` - HTTP endpoint scaffolding instructions
- Returns no-op registration for unsupported signals

**Double-Tap Logic**:

- Ctrl+C debounce with configurable window (2s default)
- `createDoubleTapTracker()`, `handleDoubleTap()`
- Immediate exit on second tap (exit code 130)

**Convenience Wrappers**:

- `onShutdown()` - SIGTERM/SIGINT handlers
- `onReload()` - SIGHUP config reload
- `onUSR1()`, `onUSR2()` - User-defined signals
- `onEmergencyQuit()` - SIGQUIT immediate exit
- `onAnyShutdown()` - All shutdown signals

**Config Reload Helper**:

- `createConfigReloadHandler()` - Schema-validated config reloading
- `ConfigReloadTracker` - Tracks reload attempts, successes, failures
- Validates via TSFulmen schema module before restart

**HTTP Endpoint Helper**:

- `createSignalEndpoint()` - Framework-agnostic POST /admin/signal handler
- `createBearerTokenAuth()`, `createSimpleRateLimiter()` - Production-ready examples
- Authentication and rate-limiting hooks
- Platform-aware: serves Windows deployments, enhances POSIX observability

**CLI Commands**:

- `signals show [signal]` - Display catalog or specific signal
- `signals show --behaviors` - Display behavior definitions
- `signals validate <file>` - Validate signal config against schema
- `signals platform` - Show platform capabilities

**Makefile Integration**:

- `make validate-signals` - Catalog integrity check
- `make verify-signals-parity` - Structure validation
- Integrated into `make check-all` quality gates

**Testing**: 180 test cases (parity, unit, integration)

### FulHash Performance Optimization

Significant performance improvement for small input hashing operations.

**Performance Gains**:

- **22x faster**: 0.132ms → 0.006ms per operation
- **182,265 ops/sec**: Up from 7,570 ops/sec
- **Throughput**: XXH3-128 now 2x faster than SHA-256 (was 15x slower)
- **Large inputs**: Maintained at >4 GB/s throughput
- **Streaming**: Variance improved from ±97% to ±5%

**Root Cause Fix**:

- Eliminated WASM initialization overhead
- Uses cached `xxhash128()` helper from hash-wasm
- Corrected performance inversion for XXH3-128

**Benchmarks** (10,000 operations, 28 bytes each):

- Before: 1,321ms total (7,570 ops/sec)
- After: 57ms total (182,265 ops/sec)
- Improvement: 23x faster

**Zero Regressions**: All 1,465 tests passing

---

## Changed

- **buildEnvVar**: Now normalizes invalid characters to underscores
  - Examples: `'database-url'` → `'MYAPP_DATABASE_URL'`, `'my.config'` → `'MYAPP_MY_CONFIG'`
- **Exit Codes**: Fixed SIGUSR1/SIGUSR2 codes to use BSD values (159/160) for platform consistency
- **CLI Entry Point**: Added main execution block to `src/schema/cli.ts`
- **Version**: Bumped to 0.1.5 across all metadata

---

## Quality Metrics

- **Test Coverage**: 1,465 tests passing (100% pass rate)
  - 93 new appidentity tests
  - 180 new signals tests
  - 1,192 existing tests maintained
- **Quality Gates**: All `make check-all` checks passing
- **Type Safety**: Zero TypeScript errors with strict mode
- **Linting**: Zero Biome warnings
- **Performance**: FulHash benchmarks stable and consistent
- **Cross-Language Parity**: App identity and signals compatible with pyfulmen/gofulmen

---

## Breaking Changes

**None** - All changes are additive or internal optimizations. Existing APIs remain unchanged.

---

## Documentation

- **README.md**: Added Application Identity and Signal Handling sections with usage examples
- **docs/tsfulmen_overview.md**: Updated module catalog with new entries
- **docs/crucible-ts/guides/consuming-crucible-assets.md**: Added identity integration examples
- **AGENTS.md**: Added caveat about `bun test` vs `bun run test`

---

## Dependencies

- Synced with Crucible v0.2.6 app-identity and signals schemas
- No new external dependencies

---

## Upgrade Guide

### From v0.1.4 to v0.1.5

**No breaking changes** - v0.1.5 is fully backward compatible with v0.1.4.

**New Features Available**:

1. **Application Identity**: Add `.fulmen/app.yaml` to enable identity features
2. **Signal Handling**: Import from `@fulmenhq/tsfulmen/foundry/signals`
3. **FulHash**: Automatic performance improvement (no code changes needed)

**Example: Adding Application Identity**:

```typescript
// Create .fulmen/app.yaml in repository root
// Then use in your application:
import { loadIdentity, getBinaryName } from "@fulmenhq/tsfulmen/appidentity";

const identity = await loadIdentity();
console.log(`Running: ${getBinaryName(identity)}`);
```

**Example: Adding Signal Handling**:

```typescript
import { createSignalManager, onShutdown } from "@fulmenhq/tsfulmen/foundry";

const manager = createSignalManager({ logger, telemetry });

onShutdown(manager, async () => {
  await db.close();
  await server.close();
});
```

---

## Known Issues

None reported.

---

## Contributors

- Module Weaver (@module-weaver) - AI agent supervised by @3leapsdave
- Dave Thompson (@3leapsdave) - Human maintainer

---

## Related Releases

- [gofulmen v0.1.5](https://github.com/fulmenhq/gofulmen/releases/tag/v0.1.5) - Go signal handling
- [pyfulmen v0.1.10](https://github.com/fulmenhq/pyfulmen/releases/tag/v0.1.10) - Python app identity
- [Crucible v0.2.6](https://github.com/fulmenhq/crucible/releases/tag/v0.2.6) - Signals SSOT

---

**Download**: [v0.1.5 on npm](https://www.npmjs.com/package/@fulmenhq/tsfulmen)  
**GitHub Release**: [v0.1.5](https://github.com/fulmenhq/tsfulmen/releases/tag/v0.1.5)

---

Generated by Module Weaver (@module-weaver) ([OpenCode](https://github.com/sst/opencode)) under supervision of @3leapsdave
