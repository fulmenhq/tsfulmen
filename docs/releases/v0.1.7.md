# TSFulmen v0.1.7 Release Notes

**Release Date**: November 6, 2025  
**Release Type**: Infrastructure Fix  
**Status**: âœ… Released

---

## Summary

TSFulmen v0.1.7 addresses critical infrastructure gaps in version management discovered during the v0.1.6 release. This release implements automated VERSION constant synchronization and verification to prevent drift between package.json metadata and runtime exports.

**Key Improvements**:

- Automated VERSION constant synchronization across package.json and source code
- Pre-publish verification validates VERSION consistency
- Enhanced release workflow prevents version drift issues
- Improved Makefile targets for consistent formatting and quality checks

**Note**: v0.1.6 was skipped due to packaging issues discovered after publishing to npm. The package.json declared version 0.1.6, but the code exported VERSION = '0.1.5'. The GitHub release for v0.1.6 was removed, and users who installed v0.1.6 from npm will experience this VERSION mismatch. This release corrects the infrastructure to prevent this class of errors.

---

## What Went Wrong in v0.1.6

### The Problem

During the v0.1.6 release, we discovered a VERSION constant mismatch:

- `package.json`: `"version": "0.1.6"`
- `src/index.ts`: `export const VERSION = '0.1.5'`
- **Result**: Runtime `VERSION` export returned `'0.1.5'` despite npm showing `0.1.6`

### Why It Wasn't Caught

1. **Manual sync required**: VERSION constant in `src/index.ts` needed manual updating
2. **No verification**: `make verify-artifacts` checked file structure but not content correctness
3. **Workflow gap**: Version bump workflow didn't include VERSION constant propagation

### Root Cause

The VERSION file is the source of truth, and `goneat version propagate` updates `package.json`, but there was no mechanism to update the `src/index.ts` VERSION constant. Human error in manual synchronization led to the drift.

---

## Changes in v0.1.7

### Enhanced Version Synchronization

**`scripts/version-sync.ts` Enhancement**:

- Now updates both `package.json` AND `src/index.ts` VERSION constant
- Single script maintains version consistency across all locations
- Regex-based replacement: `/export const VERSION = '[^']+';/`

**Usage**:

```bash
echo "0.1.7" > VERSION
goneat version propagate  # Updates package.json
bun run scripts/version-sync.ts # Updates src/index.ts
```

### Automated Verification

**`scripts/verify-package-artifacts.ts` Enhancement**:

- New VERSION consistency check extracts VERSION from built `dist/index.js`
- Compares against `package.json` version
- Fails pre-publish if mismatch detected

**Output**:

```
ðŸ” Verifying version consistency...
  âœ… Version consistency: 0.1.7
```

**Error Example** (if mismatch found):

```
âŒ VERSION mismatch: package.json=0.1.7, exported=0.1.6
```

### Makefile Improvements

**Updated `prepush` Target**:

```makefile
prepush: fmt check-all ## Run pre-push hooks (format first, then all quality checks)
```

- Now runs `fmt` before `check-all`
- Ensures code is formatted before running quality checks
- Aligns with pre-commit hook behavior

### Bootstrap Verification

**Confirmed Working**:

- `goneat` installation works correctly
- `make bootstrap` installs goneat via `sfetch`
- Makefile targets (`fmt`, `lint`, etc.) use `goneat` from PATH
- Pre-commit and pre-push hooks execute properly

---

## Recommended Upgrade Path

### For Users on v0.1.6

```bash
npm install @fulmenhq/tsfulmen@0.1.7
# or
bun add @fulmenhq/tsfulmen@0.1.7
```

**Impact**: The VERSION mismatch in v0.1.6 is cosmetic - all functionality works correctly. Upgrading to v0.1.7 corrects the VERSION export.

### For New Users

```bash
npm install @fulmenhq/tsfulmen
# or
bun add @fulmenhq/tsfulmen
```

v0.1.7 is now the recommended version with verified VERSION consistency.

---

## Testing

### Version Verification

```bash
node -e "import('@fulmenhq/tsfulmen').then(m => console.log(m.VERSION))"
# Expected: 0.1.7
```

### Package Metadata

```bash
npm view @fulmenhq/tsfulmen version
# Expected: 0.1.7
```

### Local Verification

```bash
make clean
make build
make verify-artifacts
# Should pass with: âœ… Version consistency: 0.1.7
```

---

## Infrastructure Changes

### Files Modified

| File                                  | Change   | Purpose                                 |
| ------------------------------------- | -------- | --------------------------------------- |
| `scripts/version-sync.ts`             | Enhanced | Updates `src/index.ts` VERSION constant |
| `scripts/verify-package-artifacts.ts` | Enhanced | Validates VERSION consistency           |
| `Makefile`                            | Updated  | `prepush` now runs `fmt` first          |

### New Workflow

**Version Bump Process**:

```bash
# 1. Update VERSION file
echo "0.1.7" > VERSION

# 2. Propagate to package.json
goneat version propagate

# 3. Sync to src/index.ts
bun run scripts/version-sync.ts

# 4. Rebuild
make clean build

# 5. Verify
make verify-artifacts
```

This workflow is now documented and automated to prevent future version drift.

---

## Lessons Learned

### What We Improved

1. **Automated Synchronization**: Single script (`version-sync.ts`) handles all version updates
2. **Semantic Verification**: Check content correctness, not just file presence
3. **Pre-publish Gates**: Verification catches issues before publishing
4. **Workflow Documentation**: Clear steps prevent human error

### Process Improvements

- **Don't trust structure alone**: Verify semantic correctness of built artifacts
- **Automate repetitive tasks**: Version synchronization should never be manual
- **Test the test tools**: Bootstrap verification ensures tooling works
- **Document the workflow**: Clear process prevents mistakes

### Standards for Future Releases

- âœ… Always run `make verify-artifacts` before publishing
- âœ… Use `scripts/version-sync.ts` for version bumps
- âœ… Verify VERSION constant matches package.json in built output
- âœ… Test bootstrap process works for new contributors

---

## Statistics

- **Commits in Release**: 2
  - Infrastructure improvements
  - Formatting fixes
- **Files Changed**: 9
  - 3 core infrastructure files
  - 6 formatting-only changes (GitHub templates, package.json)
- **Test Coverage**: 1,465 tests passing (100% pass rate)
- **Quality Status**: âœ… All checks passing

---

## Credits

**Module Weaver** (@module-weaver) - Implementation and testing  
**Supervised by**: @3leapsdave

Generated via [OpenCode](https://github.com/sst/opencode) agentic workflow.

---

## Links

- **npm Package**: https://www.npmjs.com/package/@fulmenhq/tsfulmen
- **GitHub Release**: https://github.com/fulmenhq/tsfulmen/releases/tag/v0.1.7
- **Issues**: https://github.com/fulmenhq/tsfulmen/issues
- **Changelog**: [CHANGELOG.md](../../CHANGELOG.md)

---

**Next**: v0.1.8 will focus on [feature development continues as planned]
