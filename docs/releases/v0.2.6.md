# Release v0.2.6 (2026-02-03)

**Release Type**: Emergency Bugfix  
**Supersedes**: v0.2.5 (broken)

## Overview

Emergency release fixing two critical bugs that made v0.2.5 unusable after npm installation. This release demonstrates the critical importance of following RELEASE_CHECKLIST.md completely before tagging.

## What Changed

### Fixed

#### 1. ESM Import Errors (Critical)

**Problem**: Missing `.js` extensions on ajv subpath imports caused runtime errors when package installed via npm.

**Error**:

```
Error [ERR_MODULE_NOT_FOUND]: Cannot find module '/tmp/test-install/node_modules/ajv/dist/2019'
imported from /tmp/test-install/node_modules/@fulmenhq/tsfulmen/dist/index.js
Did you mean to import "ajv/dist/2019.js"?
```

**Root Cause**:

- TypeScript/tsup doesn't automatically add `.js` extensions to ESM subpath imports
- Imports worked in development but failed when package installed via npm
- `make verify-local-install` would have caught this but was skipped

**Fix** (commit `86fdb32`):

```typescript
// Before (broken)
import Ajv2019 from "ajv/dist/2019";
import Ajv2020 from "ajv/dist/2020";

// After (fixed)
import Ajv2019 from "ajv/dist/2019.js";
import Ajv2020 from "ajv/dist/2020.js";
```

**Impact**: Schema validation module was completely broken in v0.2.5

#### 2. Test Timeout in CI (Critical)

**Problem**: `isGoneatAvailable()` test hung for 60s in CI prepublish, blocking npm publish.

**Error**:

```
Error: Test timed out in 60000ms.
‚ùØ src/schema/__tests__/goneat-bridge.test.ts:99:5
```

**Root Cause**:

- Spawn promise had no timeout when testing if goneat exists
- When goneat not in PATH, process hung indefinitely
- Blocked prepublishOnly hook, preventing npm publish

**Fix** (commit `e006df4`):

```typescript
return new Promise((resolve) => {
  const proc = spawn(pathToTest, ["version"], { stdio: "ignore" });

  // Timeout after 5 seconds to prevent hanging in CI
  const timeout = setTimeout(() => {
    proc.kill();
    resolve(false);
  }, 5000);

  proc.on("close", (code) => {
    clearTimeout(timeout);
    resolve(code === 0);
  });
  proc.on("error", () => {
    clearTimeout(timeout);
    resolve(false);
  });
});
```

**Impact**: Prepublish test suite timed out on 2-core CI runners

## Technical Details

### The v0.2.5 Failure

**What Went Wrong**:

1. Created tag v0.2.5 **without running `make verify-local-install`**
2. CI publish job succeeded (Bootstrap had issues but got through)
3. Published v0.2.5 to npm with commit `07420a9` (missing ESM fixes)
4. Post-release verification discovered ESM import failures
5. Attempted to retag but v0.2.5 was already published to npm
6. npm doesn't allow republishing same version

**Why It Happened**:

- Violated RELEASE_CHECKLIST.md by skipping dry-run verification
- Did not run `make verify-local-install` (Step 2 of "Dry-Run Verification")
- Did not run `npm publish --dry-run` (Step 3)
- Process discipline failure, not a tooling failure

### The Checklist Exists For A Reason

From RELEASE_CHECKLIST.md:

```
## Dry-Run Verification (CRITICAL - Prevents Burning Tags)

These steps MUST pass before creating any tags.

### Step 2: Local Install Test

make verify-local-install

Expected: ‚úÖ Package verified - Safe to publish

Why: Catches path resolution bugs that only appear in installed packages
```

This step would have caught **both** bugs before we burned the v0.2.5 tag.

## Files Changed

### Bugfixes

- `src/schema/validator.ts` - Added `.js` extensions to ajv imports
- `src/schema/goneat-bridge.ts` - Added timeout to spawn

### Documentation

- `AGENTS.md` - Added **CRITICAL** section about RELEASE_CHECKLIST.md
- `CHANGELOG.md` - Documented v0.2.6 fixes and marked v0.2.5 as broken
- `RELEASE_NOTES.md` - Emergency release notes
- `docs/releases/v0.2.6.md` - This document

### Version Bump

- `VERSION` - 0.2.5 ‚Üí 0.2.6
- `package.json` - 0.2.5 ‚Üí 0.2.6
- `src/index.ts` - VERSION constant updated
- `src/__tests__/index.test.ts` - Test updated

## Process Improvements

### AGENTS.md Update

Added prominent **CRITICAL** section before release tagging operations:

```markdown
### üö® CRITICAL: Before ANY Release Tagging

**MANDATORY**: Read and strictly follow `RELEASE_CHECKLIST.md` before creating any release tags.

Required Steps:

1. make verify-artifacts
2. make verify-local-install
3. npm publish --dry-run
4. Review all output

DO NOT:
‚ùå Create release tags without completing all checklist steps
‚ùå Skip verify-local-install (catches issues CI won't find)
‚ùå Proceed with tagging if any verification step fails
‚ùå Assume CI will catch issues (it runs too late)
```

### Crucible Role Prompts Request

Created `.plans/crucible/20260203/role-prompts-release-checklist.md` requesting that `cicd`, `qa`, and `devlead` role prompts emphasize RELEASE_CHECKLIST.md compliance.

## Quality Gates (This Time, For Real)

‚úÖ **All verification steps completed BEFORE tagging**:

```bash
# Step 1: Verify artifacts
make verify-artifacts
# ‚úÖ All artifact verification checks PASSED

# Step 2: Test local install
make verify-local-install
# ‚úÖ Package verified - Safe to publish

# Step 3: Dry-run publish
npm publish --dry-run
# ‚úÖ Prepublish hooks pass, package contents correct

# Step 4: Run full test suite
make test
# ‚úÖ 2107 passed | 16 skipped (2123)

# Step 5: Full quality checks
make check-all
# ‚úÖ All checks passed
```

## Breaking Changes

None.

## Migration Guide

If you installed v0.2.5:

```bash
# Update to v0.2.6
npm install @fulmenhq/tsfulmen@0.2.6

# Or if using yarn
yarn upgrade @fulmenhq/tsfulmen@0.2.6

# Or if using pnpm
pnpm update @fulmenhq/tsfulmen@0.2.6
```

No code changes required - v0.2.6 is a drop-in replacement that fixes runtime errors.

## Lessons Learned

1. **Checklists exist for a reason** - RELEASE_CHECKLIST.md would have prevented this
2. **CI is not enough** - CI runs after tagging, can't prevent bad tags
3. **verify-local-install is critical** - Catches runtime issues CI tests won't find
4. **Version numbers can't be reused** - Once published to npm, they're burned forever
5. **Process discipline matters** - Skipping steps has real consequences

## What's Next

Future releases will:

- ‚úÖ Strictly follow RELEASE_CHECKLIST.md (now emphasized in AGENTS.md)
- ‚úÖ Consider automation to enforce checklist completion
- ‚úÖ Update Crucible role prompts to emphasize release process discipline

---

**Generated by**: Claude Sonnet 4.5 via OpenCode  
**Role**: releng  
**Maintainer**: @3leapsdave
