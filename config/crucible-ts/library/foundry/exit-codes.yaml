$schema: https://schemas.fulmenhq.dev/library/foundry/v1.0.0/exit-codes.schema.json
description: Standard exit codes for Fulmen ecosystem tools and libraries
version: v1.0.0
categories:
  - id: standard
    name: Standard Exit Codes
    description: POSIX standard success and generic failure codes
    range:
      min: 0
      max: 1
    codes:
      - code: 0
        name: EXIT_SUCCESS
        description: Successful execution
        context: Command completed without errors
      - code: 1
        name: EXIT_FAILURE
        description: Generic failure (unspecified error)
        context: Use when no more specific exit code applies
  - id: networking
    name: Networking & Port Management
    description: Network-related failures (ports, connectivity, etc.)
    range:
      min: 10
      max: 19
    codes:
      - code: 10
        name: EXIT_PORT_IN_USE
        description: Specified port is already in use
        context: Server startup when port unavailable and fail_if_unavailable strategy
      - code: 11
        name: EXIT_PORT_RANGE_EXHAUSTED
        description: No available ports in configured range
        context: Server startup when all ports in environment range occupied
      - code: 12
        name: EXIT_INSTANCE_ALREADY_RUNNING
        description: Another instance already running on target port
        context: Server startup when PID registry shows active process on port
      - code: 13
        name: EXIT_NETWORK_UNREACHABLE
        description: Network destination unreachable
        context: Client connections, health checks, external service validation
      - code: 14
        name: EXIT_CONNECTION_REFUSED
        description: Connection refused by remote host
        context: Database connections, API endpoints, upstream services
      - code: 15
        name: EXIT_CONNECTION_TIMEOUT
        description: Connection attempt timed out
        context: Slow networks, unresponsive services, firewall blocks
  - id: configuration
    name: Configuration & Validation
    description: Configuration errors, validation failures, version mismatches
    range:
      min: 20
      max: 29
    codes:
      - code: 20
        name: EXIT_CONFIG_INVALID
        description: Configuration file failed validation
        context: Startup validation, schema mismatches, invalid YAML/JSON
        retry_hint: no_retry
      - code: 21
        name: EXIT_MISSING_DEPENDENCY
        description: Required dependency not found
        context: Missing binaries, libraries, or runtime requirements
        retry_hint: investigate
      - code: 22
        name: EXIT_SSOT_VERSION_MISMATCH
        description: SSOT (Crucible) version incompatible
        context: Helper library detects unsupported Crucible version
        retry_hint: no_retry
      - code: 23
        name: EXIT_CONFIG_FILE_NOT_FOUND
        description: Required configuration file not found
        context: Explicitly specified config path doesn't exist
      - code: 24
        name: EXIT_ENVIRONMENT_INVALID
        description: Invalid or unsupported environment specification
        context: Unknown environment name, missing environment config
  - id: runtime
    name: Runtime Errors
    description: Errors during normal operation (health checks, database, etc.)
    range:
      min: 30
      max: 39
    codes:
      - code: 30
        name: EXIT_HEALTH_CHECK_FAILED
        description: Health check endpoint returned non-healthy status
        context: Startup health validation, readiness probes
        retry_hint: retry
      - code: 31
        name: EXIT_DATABASE_UNAVAILABLE
        description: Database connection failed or unavailable
        context: Startup connection checks, critical query failures
        retry_hint: retry
      - code: 32
        name: EXIT_EXTERNAL_SERVICE_UNAVAILABLE
        description: Required external service unavailable
        context: API dependencies, message queues, cache servers
      - code: 33
        name: EXIT_RESOURCE_EXHAUSTED
        description: System resources exhausted (memory, disk, file descriptors)
        context: Out-of-memory, disk full, too many open files
        retry_hint: investigate
      - code: 34
        name: EXIT_OPERATION_TIMEOUT
        description: Operation exceeded timeout threshold
        context: Long-running tasks, async operations, batch processing
        retry_hint: retry
  - id: usage
    name: Command-Line Usage Errors
    description: Invalid arguments, missing required flags, usage errors
    range:
      min: 40
      max: 49
    codes:
      - code: 40
        name: EXIT_INVALID_ARGUMENT
        description: Invalid command-line argument or flag value
        context: Type errors, out-of-range values, malformed input
      - code: 41
        name: EXIT_MISSING_REQUIRED_ARGUMENT
        description: Required command-line argument not provided
        context: Missing --config, --port, or other required flags
      - code: 64
        name: EXIT_USAGE
        description: Command-line usage error
        context: BSD sysexits.h EX_USAGE - wrong number of arguments, bad syntax
        bsd_equivalent: EX_USAGE
  - id: permissions
    name: Permissions & File Access
    description: Permission denied, file not found, access errors
    range:
      min: 50
      max: 59
    codes:
      - code: 50
        name: EXIT_PERMISSION_DENIED
        description: Insufficient permissions for operation
        context: File access, port binding (<1024), privileged operations
      - code: 51
        name: EXIT_FILE_NOT_FOUND
        description: Required file not found
        context: Assets, templates, data files (not config - use 23)
      - code: 52
        name: EXIT_DIRECTORY_NOT_FOUND
        description: Required directory not found
        context: State directories, log paths, data directories
      - code: 53
        name: EXIT_FILE_READ_ERROR
        description: Error reading file
        context: Corrupt files, I/O errors, encoding issues
      - code: 54
        name: EXIT_FILE_WRITE_ERROR
        description: Error writing file
        context: Disk full, read-only filesystem, permission errors
  - id: data
    name: Data & Processing Errors
    description: Data validation, parsing, transformation failures
    range:
      min: 60
      max: 69
    codes:
      - code: 60
        name: EXIT_DATA_INVALID
        description: Input data failed validation
        context: Schema validation, business rule violations
      - code: 61
        name: EXIT_PARSE_ERROR
        description: Error parsing input data
        context: Malformed JSON/YAML/XML, syntax errors
      - code: 62
        name: EXIT_TRANSFORMATION_FAILED
        description: Data transformation or conversion failed
        context: Type conversions, format transformations, encoding changes
      - code: 63
        name: EXIT_DATA_CORRUPT
        description: Data corruption detected
        context: Checksum failures, integrity violations
  - id: security
    name: Security & Authentication
    description: Authentication failures, authorization errors, security violations
    range:
      min: 70
      max: 79
    codes:
      - code: 70
        name: EXIT_AUTHENTICATION_FAILED
        description: Authentication failed
        context: Invalid credentials, expired tokens, auth service unavailable
      - code: 71
        name: EXIT_AUTHORIZATION_FAILED
        description: Authorization failed (authenticated but insufficient permissions)
        context: RBAC failures, scope violations, resource access denied
      - code: 72
        name: EXIT_SECURITY_VIOLATION
        description: Security policy violation detected
        context: Suspicious activity, rate limit exceeded, IP blocklist
      - code: 73
        name: EXIT_CERTIFICATE_INVALID
        description: TLS/SSL certificate validation failed
        context: Expired certs, untrusted CAs, hostname mismatches
        bsd_equivalent: EX_PROTOCOL
  - id: observability
    name: Observability & Monitoring
    description: |
      Observability infrastructure failures. Use when observability is CRITICAL
      to operation (e.g., monitoring agents, telemetry exporters).

      For workhorses where observability is auxiliary:
      - Log warning and continue (don't exit)
      - Emit degraded health status
      - Only exit if explicitly configured (fail_on_observability_error: true)
    range:
      min: 80
      max: 89
    codes:
      - code: 80
        name: EXIT_METRICS_UNAVAILABLE
        description: Metrics endpoint or collection system unavailable
        context: |
          Use for observability-focused tools (Prometheus exporters, StatsD agents).
          Workhorses SHOULD log warning and continue unless configured to fail-fast.
      - code: 81
        name: EXIT_TRACING_FAILED
        description: Distributed tracing system unavailable
        context: OTLP exporter failed, Jaeger collector unreachable
      - code: 82
        name: EXIT_LOGGING_FAILED
        description: Logging system unavailable or misconfigured
        context: Log aggregator unreachable, log file unwritable
      - code: 83
        name: EXIT_ALERT_SYSTEM_FAILED
        description: Alerting system unavailable
        context: PagerDuty API failed, Slack webhook unreachable
      - code: 84
        name: EXIT_STRUCTURED_LOGGING_FAILED
        description: Structured logging system unavailable
        context: JSON log aggregator unreachable, log schema validation failed
  - id: testing
    name: Testing & Validation
    description: |
      Test execution outcomes and validation failures.

      NOTE: Test harnesses MUST use EXIT_SUCCESS (0) for successful test runs
      per ecosystem conventions (pytest, Go testing, Jest all use 0 for success).
      Codes in this category are for FAILURES and exceptional conditions only.
    range:
      min: 91
      max: 99
    codes:
      - code: 91
        name: EXIT_TEST_FAILURE
        description: One or more tests failed
        context: |
          Test assertions failed, expected behavior not met.
          Maps to pytest exit code 1, Go test failure, Jest failure.
      - code: 92
        name: EXIT_TEST_ERROR
        description: Test execution error (not test failure)
        context: |
          Test setup failed, fixture unavailable, test harness error.
          Maps to pytest exit code 3 (internal error).
      - code: 93
        name: EXIT_TEST_INTERRUPTED
        description: Test run interrupted by user or system
        context: |
          Ctrl+C during tests, system signal, user cancellation.
          Maps to pytest exit code 2.
      - code: 94
        name: EXIT_TEST_USAGE_ERROR
        description: Test command usage error
        context: |
          Invalid test arguments, bad configuration.
          Maps to pytest exit code 4.
      - code: 95
        name: EXIT_TEST_NO_TESTS_COLLECTED
        description: No tests found or all tests skipped
        context: |
          Empty test suite, all tests deselected or skipped.
          Maps to pytest exit code 5.
      - code: 96
        name: EXIT_COVERAGE_THRESHOLD_NOT_MET
        description: Test coverage below required threshold
        context: Code coverage validation, quality gate failure
  - id: signals
    name: Signal-Induced Exits
    description: |-
      Process terminated by Unix signals (128+N pattern per POSIX).
      Signal codes follow Linux numbering; macOS/FreeBSD differ for SIGUSR1/SIGUSR2.
      For full signal semantics, see config/library/foundry/signals.yaml.
      For signal handling patterns, see docs/standards/library/modules/signal-handling.md.
    range:
      min: 128
      max: 165
    codes:
      - code: 129
        name: EXIT_SIGNAL_HUP
        description: Hangup signal (SIGHUP) - config reload via restart
        context: |-
          Config reload via restart-based pattern (mandatory schema validation).
          Process exits with 129, supervisor restarts with new config.
          See signals.yaml for reload behavior definition.
        bsd_equivalent: "128 + 1"
        signal_catalog: config/library/foundry/signals.yaml#hup
      - code: 130
        name: EXIT_SIGNAL_INT
        description: Interrupt signal (SIGINT) - user interrupt with Ctrl+C double-tap
        context: |-
          Ctrl+C pressed. First tap initiates graceful shutdown, second within 2s forces immediate exit.
          Same exit code (130) for both graceful and force modes.
          See signals.yaml for double-tap behavior definition.
        bsd_equivalent: "128 + 2"
        signal_catalog: config/library/foundry/signals.yaml#int
      - code: 131
        name: EXIT_SIGNAL_QUIT
        description: Quit signal (SIGQUIT) - immediate exit
        context: |-
          Ctrl+\ on Unix, Ctrl+Break on Windows. Immediate termination without cleanup.
          Use for emergency shutdown or debugging (core dumps).
        bsd_equivalent: "128 + 3"
        signal_catalog: config/library/foundry/signals.yaml#quit
      - code: 137
        name: EXIT_SIGNAL_KILL
        description: Kill signal (SIGKILL)
        context: Forceful termination, non-graceful shutdown (not catchable)
        bsd_equivalent: "128 + 9"
        python_note: "Cannot be caught in Python (OS-level)"
      - code: 141
        name: EXIT_SIGNAL_PIPE
        description: Broken pipe (SIGPIPE) - observe only
        context: |-
          Writing to closed pipe/socket. Fulmen default is observe_only (log + graceful exit).
          Applications may override to ignore for network services.
          See signals.yaml for SIGPIPE handling guidance.
        bsd_equivalent: "128 + 13"
        python_note: "Raised as BrokenPipeError exception"
        signal_catalog: config/library/foundry/signals.yaml#pipe
      - code: 142
        name: EXIT_SIGNAL_ALRM
        description: Alarm signal (SIGALRM) - watchdog timeout
        context: |-
          Watchdog timer expired. Treat as timeout-induced exit.
          Watchdog pattern out of scope for v1.0.0 module implementations.
        bsd_equivalent: "128 + 14"
        python_note: "Supported by signal module, rarely used in practice"
        signal_catalog: config/library/foundry/signals.yaml#alrm
      - code: 143
        name: EXIT_SIGNAL_TERM
        description: Termination signal (SIGTERM) - graceful shutdown
        context: |-
          Graceful shutdown requested by container orchestrator or process supervisor.
          Standard 30-second timeout for cleanup. Applications run cleanup handlers before exit.
          See signals.yaml for graceful shutdown behavior definition.
        bsd_equivalent: "128 + 15"
        python_note: "Default signal for graceful shutdown"
        signal_catalog: config/library/foundry/signals.yaml#term
      - code: 138
        name: EXIT_SIGNAL_USR1
        description: User-defined signal 1 (SIGUSR1) - custom handler
        context: |-
          Application-specific signal (e.g., reopen logs, dump stats, trigger profiling).
          Applications register custom handlers. Exit code 138 on Linux (128+10).
          Platform differences: macOS/FreeBSD use signal 30 (exit 158), not 10.
        linux_calculation: "128 + 10"
        macos_calculation: "128 + 30 = 158"
        signal_catalog: config/library/foundry/signals.yaml#usr1
      - code: 140
        name: EXIT_SIGNAL_USR2
        description: User-defined signal 2 (SIGUSR2) - custom handler
        context: |-
          Application-specific signal (e.g., toggle debug mode, rotate credentials).
          Applications register custom handlers. Exit code 140 on Linux (128+12).
          Platform differences: macOS/FreeBSD use signal 31 (exit 159), not 12.
        linux_calculation: "128 + 12"
        macos_calculation: "128 + 31 = 159"
        signal_catalog: config/library/foundry/signals.yaml#usr2
bsd_compatibility:
  description: |
    BSD sysexits.h compatibility mapping. Some BSD codes conflict with Fulmen
    ranges or are functionally redundant. We provide pragmatic mappings to
    maintain BSD compatibility while preserving Fulmen's semantic categories.
  mappings:
    - bsd_code: 64
      bsd_name: EX_USAGE
      fulmen_code: 64
      fulmen_name: EXIT_USAGE
      category: usage
      notes: |
        Code 64 breaks the usage category range (40-49) but preserved for BSD
        compatibility. Applications expecting BSD exit codes can use 64 directly.
    - bsd_code: 71
      bsd_name: EX_OSERR
      fulmen_code: 33
      fulmen_name: EXIT_RESOURCE_EXHAUSTED
      category: runtime
      notes: |
        BSD EX_OSERR (71) conflicts with EXIT_AUTHORIZATION_FAILED (71) in security
        category. Pragmatically mapped to RESOURCE_EXHAUSTED (33) as OS errors
        often manifest as resource exhaustion (memory, file descriptors, etc.).
    - bsd_code: 74
      bsd_name: EX_IOERR
      fulmen_code: 54
      fulmen_name: EXIT_FILE_WRITE_ERROR
      category: permissions
      notes: |
        BSD EX_IOERR (74) mapped to FILE_WRITE_ERROR (54). I/O errors in BSD
        context typically involve file operations. For read errors, use
        EXIT_FILE_READ_ERROR (53).
    - bsd_code: 75
      bsd_name: EX_TEMPFAIL
      fulmen_code: 34
      fulmen_name: EXIT_OPERATION_TIMEOUT
      category: runtime
      notes: |
        BSD EX_TEMPFAIL (75) indicates temporary failure (retry later). Mapped to
        OPERATION_TIMEOUT (34) as temporary failures often involve timeouts.
        Alternative: EXIT_EXTERNAL_SERVICE_UNAVAILABLE (32) for service issues.
extensions:
  ranges:
    - range:
        min: 100
        max: 127
      purpose: Reserved for application-specific codes (workhorse breeds, tools)
      sizing_guidance: |
        28 codes sufficient for most workhorses:
        - Simple workhorse (CLI + basic server): 5-10 codes
        - Moderate workhorse (multiple integrations): 15-20 codes
        - Complex workhorse (platform/orchestrator): 20-25 codes
        If you need more than 25 codes, consider using user-defined range (192-254)
        or re-evaluate if generic codes can replace app-specific ones.
    - range:
        min: 166
        max: 191
      purpose: Reserved for future signal extensions (128-165 used for standard signals)
    - range:
        min: 192
        max: 254
      purpose: Reserved for user-defined codes in application configs
simplified_modes:
  - id: basic
    name: Basic Exit Codes
    description: Minimal exit code set for simple scripts and novice-friendly tools
    mappings:
      - simplified_code: 0
        simplified_name: SUCCESS
        maps_from: [0]
      - simplified_code: 1
        simplified_name: ERROR
        maps_from: [1, 10, 11, 12, 13, 14, 15, 20, 21, 22, 23, 24, 30, 31, 32, 33, 34, 40, 41, 50, 51, 52, 53, 54, 60, 61, 62, 63, 70, 71, 72, 73, 80, 81, 82, 83, 84, 91, 92, 93, 94, 95, 96, 129, 130, 131, 137, 138, 140, 141, 142, 143]
      - simplified_code: 2
        simplified_name: USAGE_ERROR
        maps_from: [64]
  - id: severity
    name: Severity-Based Exit Codes
    description: Exit codes grouped by severity level for intermediate users
    mappings:
      - simplified_code: 0
        simplified_name: SUCCESS
        maps_from: [0]
      - simplified_code: 1
        simplified_name: USER_ERROR
        maps_from: [40, 41, 64]
      - simplified_code: 2
        simplified_name: CONFIG_ERROR
        maps_from: [20, 21, 22, 23, 24]
      - simplified_code: 3
        simplified_name: RUNTIME_ERROR
        maps_from: [30, 31, 32, 33, 34, 60, 61, 62, 63]
      - simplified_code: 4
        simplified_name: SYSTEM_ERROR
        maps_from: [10, 11, 12, 13, 14, 15, 50, 51, 52, 53, 54, 129, 130, 131, 137, 138, 140, 141, 142, 143]
      - simplified_code: 5
        simplified_name: SECURITY_ERROR
        maps_from: [70, 71, 72, 73]
      - simplified_code: 6
        simplified_name: TEST_FAILURE
        maps_from: [91, 92, 93, 94, 95, 96]
      - simplified_code: 7
        simplified_name: OBSERVABILITY_ERROR
        maps_from: [80, 81, 82, 83, 84]
