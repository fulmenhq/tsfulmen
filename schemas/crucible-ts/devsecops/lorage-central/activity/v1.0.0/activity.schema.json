{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.fulmenhq.dev/crucible/devsecops/lorage-central/activity/v1.0.0/activity.schema.json",
  "title": "L'Orage Central Activity Record",
  "description": "Schema for audit events in L'Orage Central (e.g., unlock success, deploy start). Emitted via gofulmen observability; stored in policy.audit backend (e.g., structured logs to Turso). No sensitive data.",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Slug-compatible unique event ID (UUID-like)",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 127
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 UTC timestamp",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
    },
    "tenant": {
      "type": "string",
      "description": "Scoped tenant (from policy.tenant)",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 127
    },
    "eventType": {
      "type": "string",
      "description": "Action type (e.g., unlock for MFA success)",
      "enum": [
        "unlock",
        "deploy",
        "seed",
        "query",
        "validate",
        "error"
      ]
    },
    "outcome": {
      "type": "string",
      "description": "Result (e.g., success for valid deploy)",
      "enum": [
        "success",
        "failure",
        "warning"
      ]
    },
    "metadata": {
      "type": "object",
      "description": "Non-sensitive details (e.g., op duration, IP; no secrets)",
      "properties": {
        "sessionId": {
          "type": "string",
          "description": "Slug-compatible session ID (from REPL token)",
          "pattern": "^[a-z0-9-]+$",
          "minLength": 1,
          "maxLength": 127
        },
        "userId": {
          "type": "string",
          "description": "Anonymized user (e.g., user-123; from MFA)",
          "pattern": "^[a-z0-9-]+$",
          "minLength": 1,
          "maxLength": 63
        },
        "duration": {
          "type": "string",
          "description": "Op duration (e.g., 2.5s; for metrics)",
          "pattern": "^[0-9.]+[smhd]$"
        },
        "ip": {
          "type": "string",
          "description": "Client IP (anonymized; for audit)",
          "pattern": "^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$"
        },
        "details": {
          "type": "object",
          "description": "Op-specific details (e.g., recipe name for deploy)",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "required": [
        "sessionId",
        "userId"
      ],
      "additionalProperties": false
    },
    "backend": {
      "type": "object",
      "description": "Audit storage (refs policy.audit)",
      "properties": {
        "level": {
          "type": "string",
          "enum": [
            "simple",
            "structured"
          ]
        },
        "retain": {
          "type": "string",
          "pattern": "^([0-9]+)([smhdwMy])$"
        }
      },
      "additionalProperties": false
    }
  },
  "required": [
    "id",
    "timestamp",
    "tenant",
    "eventType",
    "outcome",
    "metadata"
  ],
  "additionalProperties": false
}
