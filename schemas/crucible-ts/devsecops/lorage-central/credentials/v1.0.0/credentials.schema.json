{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.fulmenhq.dev/crucible/devsecops/lorage-central/credentials/v1.0.0/credentials.schema.json",
  "title": "L'Orage Central Root Credentials Metadata",
  "description": "Schema for root credential metadata (e.g., GPG/Vaultwarden keys for tenant bootstrap). Loaded via gofulmen shim; used in REPL unlock/seeding. Values opaque (refs only); metadata enables expiry/audit without exposure.",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Slug-compatible credential ID (unique per tenant)",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 127
    },
    "tenant": {
      "type": "string",
      "description": "Linked tenant (from policy.tenant; enforces isolation)",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 127
    },
    "type": {
      "type": "string",
      "description": "Credential type (matches policy.isolation.store or auth-methods)",
      "enum": [
        "gpg-key",
        "vaultwarden-token",
        "turso-root",
        "yubikey-seed"
      ]
    },
    "ref": {
      "type": "string",
      "description": "Opaque reference (e.g., gpg://keyring/acme-bootstrap; decrypted by microtool)",
      "pattern": "^[a-z0-9:/.-]+$",
      "minLength": 1,
      "maxLength": 255
    },
    "metadata": {
      "type": "object",
      "description": "Non-sensitive metadata (e.g., expiry, created; for validation/audit)",
      "properties": {
        "created": {
          "type": "string",
          "description": "ISO 8601 timestamp",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
        },
        "expires": {
          "type": "string",
          "description": "Expiry timestamp (enforced in REPL)",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
        },
        "purpose": {
          "type": "string",
          "description": "Usage (e.g., tenant-bootstrap)",
          "pattern": "^[a-z0-9-]+$",
          "minLength": 1,
          "maxLength": 127
        },
        "rotation": {
          "type": "object",
          "description": "Rotation policy (optional; e.g., auto-rotate every 90d)",
          "properties": {
            "interval": {
              "type": "string",
              "description": "Rotation frequency (e.g., 90d)",
              "pattern": "^([0-9]+)([smhdwMy])$"
            },
            "method": {
              "type": "string",
              "enum": [
                "auto",
                "manual"
              ],
              "default": "manual"
            }
          },
          "additionalProperties": false
        }
      },
      "required": [
        "created",
        "expires"
      ],
      "additionalProperties": false
    },
    "backend": {
      "type": "object",
      "description": "Storage backend (refs policy.isolation.store; for root-specific overrides)",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "libsql",
            "turso",
            "gpg-file",
            "vaultwarden"
          ]
        },
        "conn": {
          "type": "object",
          "additionalProperties": true
        },
        "enc": {
          "type": "boolean",
          "default": false
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    }
  },
  "required": [
    "id",
    "tenant",
    "type",
    "ref",
    "metadata"
  ],
  "additionalProperties": false
}
